<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="zeromicro">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="https://doc.go-zero.dev/favicon.png">
<link rel="icon" href="https://doc.go-zero.dev/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="https://doc.go-zero.dev/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="go-zero Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="go-zero Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZD0YKV3XQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XZD0YKV3XQ",{anonymize_ip:!0})</script>
<link rel="manifest" href="//manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c"><title data-react-helmet="true">TimingWheel | go-zero</title><meta data-react-helmet="true" property="og:image" content><meta data-react-helmet="true" name="twitter:image" content><meta data-react-helmet="true" name="twitter:description" content="go-zero 是一个集成了各种工程实践的 web 和 rpc 框架。通过弹性设计保障了大并发服务端的稳定性，经受了充分的实战检验。"><meta data-react-helmet="true" name="twitter:title" content="Introduction | go-zero"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Introduction | go-zero&quot;"><meta data-react-helmet="true" property="og:title" content="TimingWheel | go-zero"><meta data-react-helmet="true" name="description" content="This article introduces the delayed operation in go-zero. Delayed operation, two options can be used:"><meta data-react-helmet="true" property="og:description" content="This article introduces the delayed operation in go-zero. Delayed operation, two options can be used:"><link rel="stylesheet" href="/assets/css/styles.2224638b.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="">
<meta itemprop="description" content="go-zero 是一个集成了各种工程实践的 web 和 rpc 框架。通过弹性设计保障了大并发服务端的稳定性，经受了充分的实战检验。">
<meta itemprop="url" content="https://doc.go-zero.dev">
<meta itemprop="logo" content="https://doc.go-zero.dev/img/favicon.png">
<meta itemprop="sameAs" content="https://github.com/zeromicro">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light navbar--fixed-top"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="brand_AtiA" href="/"><img alt="logo" height="30" src="/img/navbar/logo.svg" class="brand_logo_MqNk"><a class="navbar__brand brand_name_O39n">go-zero</a></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/prepare/prepare">Preparation</a></li><li><a class="dropdown__link" href="/docs/quick-start/quick-start">Getting Started</a></li><li><a class="dropdown__link" href="/docs/advance/advance">Guides</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" sidebarid="goctl">Goctl</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/goctl/installation">Installation</a></li><li><a class="dropdown__link" href="/docs/goctl/api">API Command</a></li><li><a class="dropdown__link" href="/docs/goctl/zrpc">RPC Command</a></li><li><a class="dropdown__link" href="/docs/goctl/model">Model Command</a></li><li><a class="dropdown__link" href="/docs/goctl/completion">Completion</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Tool</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/eco/plugins">Goctl Plugin</a></li><li><a class="dropdown__link" href="/docs/eco/editor">Editor Plugin</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/community/about-us">About us</a></li><li><a class="dropdown__link" href="/docs/community/showcase">Showcase</a></li><li><a class="dropdown__link" href="/docs/community/contribute">Contributing</a></li><li><a class="dropdown__link" href="/docs/community/contributor">Contributor</a></li><li><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li><li><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord</a></li></ul></div><a class="navbar__item navbar__link" sidebarid="blog" href="/docs/blog/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">More</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/resource-center/learning-resource">Resource Center</a></li><li><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="dropdown__link">Video Tutorial</a></li><li><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="dropdown__link">Development Roadmap</a></li><li><a class="dropdown__link" href="/docs/design/design">Design Docs</a></li><li><a class="dropdown__link" href="/docs/faq/troubleshooting">FAQ</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchWrapper_f8aU"><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/blog/principle/timing-wheel" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/cn/docs/blog/principle/timing-wheel" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">中文简体</a></li></ul></div><a href="https://github.com/zeromicro/go-zero" class="navbar__items navbar__items--right"><img alt="forks" height="30" src="/img/navbar/github.svg" class="star__fork_dBtt"><div class="star_fork_layout_ROo5"><img alt="stars" height="20" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="star__fork_dBtt"><img alt="forks" height="20" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="star__fork_dBtt"></div></a><div class="react-toggle themeToggleInHeading_b3Mq react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">🌙</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">☀</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">go-zero</a><div class="react-toggle themeToggleInSidebar_qGRI react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">🌙</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">☀</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/docs/blog/principle/timing-wheel" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/docs/blog/principle/timing-wheel" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">中文简体</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/prepare/prepare">Preparation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/quick-start/quick-start">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/advance/advance">Guides</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist" sidebarid="goctl">Goctl</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/api">API Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/zrpc">RPC Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/model">Model Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/completion">Completion</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Tool</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/eco/plugins">Goctl Plugin</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/eco/editor">Editor Plugin</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/community/about-us">About us</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/showcase">Showcase</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/contribute">Contributing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/contributor">Contributor</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></li><li class="menu__list-item"><a class="menu__link" sidebarid="blog" href="/docs/blog/blog">Blog</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">More</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/resource-center/learning-resource">Resource Center</a></li><li class="menu__list-item"><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="menu__link">Video Tutorial</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="menu__link">Development Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/design/design">Design Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq/troubleshooting">FAQ</a></li></ul></li></ul></div></div></div></nav><div class="wrapper_DIJ0"><div class="doc_D+rh"><div class="doc__sidebar_gVFN" role="complementary"><div class="sidebar_LIo8"><div class="menu menu--responsive thin-scrollbar menu_oAhv"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_nrF-" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" href="/docs/blog/blog">Blog</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Governance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/bloom">Bloom Filter</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/breaker-algorithms">Fusing Principle and Implementation</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/loadshedding">Load Shedding</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/periodlimit">Period Limit</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/tokenlimit">Token Limit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Cache</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/cache/cache">DB caching mechanism</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/cache/redis-cache">go-zero cache design for persistence layer cache</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/cache/business-cache">go-zero cache design for business-level caching</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/cache/collection">Caching via collection</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/executors">Executors</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/keywords">Efficient keyword replacement and sensitive word filtering tool</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/logx">logx</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Concurrency</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/fx">Fx</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/mapreduce">Mapreduce</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/stream">Stream processing</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/redis-lock">Redis Lock</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/sharedcalls">SharedCalls</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u menu__link--sublist menu__link--active" href="#!">Principle</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menuLink_Zq3u menu__link--active active" tabindex="0" href="/docs/blog/principle/timing-wheel">TimingWheel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Showcase</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/shorturl">Rapid development of microservices</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/zrpc">Enterprise RPC framework zRPC</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/mysql">Mysql</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/mapping">Mapping</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/datacenter">Data center</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/go-queue">Queue</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/go-zero-looklook">Develop a travel system using go-zero go-zero-looklook</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/metric">Microservice metrics monitoring based on prometheus</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Exchange</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/share/online-exchange">Online Communication on October 3,2020</a></li></ul></li></ul></div></div></div><main class="doc__main_VklL"><div class="padding-vert--lg container doc__item-wrapper_FIxd"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">TimingWheel</h1></header><div class="markdown"><p>This article introduces the <strong>delayed operation</strong> in <code>go-zero</code>. <strong>Delayed operation</strong>, two options can be used:</p><ol><li><code>Timer</code>: The timer maintains a priority queue, executes it at the time, and then stores the tasks that need to be executed in the map</li><li>The <code>timingWheel</code> in <code>collection</code> maintains an array for storing task groups, and each slot maintains a doubly linked list of tasks. When the execution starts, the timer executes the tasks in a slot every specified time.</li></ol><p>Scheme 2 reduces the maintenance task from the <code>priority queue O(nlog(n))</code> to the <code>doubly linked list O(1)</code>, and the execution of the task only needs to poll the tasks <code>O(N)</code> at a time point. Priority queue, put and delete elements <code>O(nlog(n))</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="timingwheel-in-cache"></a>timingWheel in cache<a class="hash-link" href="#timingwheel-in-cache" title="Direct link to heading">#</a></h2><p>First, let&#x27;s first talk about the use of TimingWheel in the cache of collection:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">timingWheel</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">NewTimingWheel</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> slots</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> ok </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#bd93f9">string</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">!</span><span class="token plain">ok </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Del</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">timingWheel </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> timingWheel</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This is the initialization of <code>cache</code> and the initialization of <code>timingWheel</code> at the same time for key expiration processing. The parameters in turn represent:</p><ul><li><code>interval</code>: Time division scale</li><li><code>numSlots</code>: time slots</li><li><code>execute</code>: execute a function at a point in time</li></ul><p>The function executed in the <code>cache</code> is to <strong>delete the expired key</strong>, and this expiration is controlled by the <code>timingWheel</code> to advance the time.</p><p><strong>Next, let&#x27;s learn about it through the use of timingWheel by cache. </strong></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="initialization"></a>Initialization<a class="hash-link" href="#initialization" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">newTimingWheelWithClock</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">interval time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Duration</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> numSlots </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> execute Execute</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> ticker timex</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Ticker</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">TimingWheel</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    tw </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">TimingWheel</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        interval</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">      interval</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">                     </span><span class="token comment" style="color:#6272a4">// Single time grid time interval</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        ticker</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">        ticker</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">                       </span><span class="token comment" style="color:#6272a4">// Timer, do time push, advance by interval</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        slots</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">         </span><span class="token function" style="color:#8be9fd">make</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">list</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">List</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> numSlots</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">// Time wheel</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        timers</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">        </span><span class="token function" style="color:#8be9fd">NewSafeMap</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">                 </span><span class="token comment" style="color:#6272a4">// Store the map of task{key, value} [parameters needed to execute execute]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        tickedPos</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">     numSlots </span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">                 </span><span class="token comment" style="color:#6272a4">// at previous virtual circle</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        execute</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">       execute</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">                      </span><span class="token comment" style="color:#6272a4">// Execution function</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        numSlots</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">      numSlots</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">                     </span><span class="token comment" style="color:#6272a4">// Initialize slots num</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        setChannel</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">    </span><span class="token function" style="color:#8be9fd">make</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">chan</span><span class="token plain"> timingEntry</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">       </span><span class="token comment" style="color:#6272a4">// The following channels are used for task delivery</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        moveChannel</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">   </span><span class="token function" style="color:#8be9fd">make</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">chan</span><span class="token plain"> baseEntry</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        removeChannel</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">make</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">chan</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        drainChannel</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">  </span><span class="token function" style="color:#8be9fd">make</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">chan</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> value </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        stopChannel</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">   </span><span class="token function" style="color:#8be9fd">make</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">chan</span><span class="token plain"> lang</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">PlaceholderType</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Prepare all the lists stored in the slot</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">initSlots</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Open asynchronous coroutine, use channel for task communication and delivery</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">run</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><img alt="76108cc071154e2faa66eada81857fb0~tplv-k3u1fbpfcp-zoom-1.image.png" src="/assets/images/76108cc071154e2faa66eada81857fb0_tplv-k3u1fbpfcp-zoom-1.image-22b9f74f02d8998fe526f7197ba127bc.png"></p><p>The above is a more intuitive display of the <strong>&quot;time wheel&quot;</strong> of the <code>timingWheel</code>, and the details of the advancement will be explained later around this picture.</p><p><code>go tw.run()</code> opens a coroutine for time promotion:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tw </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">TimingWheel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">run</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">select</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">// Timer do time push -&gt; scanAndRunTasks()</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">case</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&lt;-</span><span class="token plain">tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ticker</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Chan</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">onTick</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">// add task will enter task into setChannel</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">case</span><span class="token plain"> task </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&lt;-</span><span class="token plain">tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">setChannel</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">setTask</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">task</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token operator" style="color:#ff79c6">...</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>It can be seen that the <code>timer</code> execution is started at the time of initialization, and it is rotated in the <code>internal</code> time period, and then the bottom layer keeps getting the tasks from the <code>list</code> in the <code>slot</code> and handing them over to the <code>execute</code> for execution.</p><p><img alt="3bbddc1ebb79455da91dfcf3da6bc72f~tplv-k3u1fbpfcp-zoom-1.image.png" src="/assets/images/3bbddc1ebb79455da91dfcf3da6bc72f_tplv-k3u1fbpfcp-zoom-1.image-8a075627a6238a0be908a37de1e37ef0.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="task-operation"></a>Task Operation<a class="hash-link" href="#task-operation" title="Direct link to heading">#</a></h3><p>The next step is to set the <code>cache key</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">Cache</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">Set</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> value </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">lock</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Lock</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token boolean" style="color:#bd93f9">_</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> ok </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> value</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">lruCache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">add</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">lock</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Unlock</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    expiry </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">unstableExpiry</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">AroundDuration</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">expire</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> ok </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">timingWheel</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">MoveTimer</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> expiry</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">timingWheel</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">SetTimer</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> expiry</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><ol><li>First look at whether this key exists in the <code>data map</code></li><li>If it exists, update <code>expire</code> -&gt; <code>MoveTimer()</code></li><li>Set the key for the first time -&gt; <code>SetTimer()</code></li></ol><p>So the use of <code>timingWheel</code> is clear. Developers can <code>add</code> or <code>update</code> according to their needs.</p><p>At the same time, when we follow the source code, we will find that: <code>SetTimer() MoveTimer()</code> all transports tasks to channel, and the coroutine opened in <code>run()</code> continuously takes out the task operations of <code>channel</code>.</p><blockquote><p><code>SetTimer() -&gt; setTask()</code>：</p><ul><li>not exist task：<code>getPostion -&gt; pushBack to list -&gt; setPosition</code></li><li>exist task：<code>get from timers -&gt; moveTask()</code></li></ul><p><code>MoveTimer() -&gt; moveTask()</code></p></blockquote><p>From the above call chain, there is a function that will be called: <code>moveTask()</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tw </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">TimingWheel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">moveTask</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">task baseEntry</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// timers: Map =&gt; Get [positionEntry「pos, task」] by key</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    val</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> ok </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">timers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Get</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">!</span><span class="token plain">ok </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    timer </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> val</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">positionEntry</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// {delay &lt;interval} =&gt; The delay time is less than a time grid interval, and there is no smaller scale, indicating that the task should be executed immediately</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">delay </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">interval </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        threading</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">GoSafe</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">execute</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// If&gt; interval, the new pos, circle in the time wheel is calculated by the delay time delay</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    pos</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> circle </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">getPositionAndCircle</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">delay</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> pos </span><span class="token operator" style="color:#ff79c6">&gt;=</span><span class="token plain"> timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">pos </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">circle </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> circle</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Move offset before and after recording. To re-enter the team for later process</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">diff </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> pos </span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain"> timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">pos</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> circle </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4">// Move to the next layer and convert circle to part of diff</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        circle</span><span class="token operator" style="color:#ff79c6">--</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">circle </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> circle</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4">// Because it is an array, add numSlots [that is equivalent to going to the next level]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">diff </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">numSlots </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> pos </span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain"> timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">pos</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4">// If the offset is advanced, the task is still in the first layer at this time</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4">// Mark to delete the old task, and re-enter the team, waiting to be executed</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">removed </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">true</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        newItem </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">timingEntry</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            baseEntry</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            value</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">     timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">slots</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">pos</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">PushBack</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">newItem</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">setTimerPosition</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">pos</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> newItem</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The above process has the following situations:</p><ul><li><code>delay &lt;internal</code>: Because &lt;single time precision, it means that this task has expired and needs to be executed immediately</li><li>For changed <code>delay</code>:<ul><li><code>new &gt;= old</code>：<code>&lt;newPos, newCircle, diff&gt;</code></li><li><code>newCircle&gt; 0</code>: Calculate diff and convert circle to the next layer, so diff + numslots</li><li>If only the delay time is shortened, delete the old task mark, re-add it to the list, and wait for the next loop to be executed</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="execute"></a>Execute<a class="hash-link" href="#execute" title="Direct link to heading">#</a></h3><p>In the previous initialization, the timer in <code>run()</code> kept advancing, and the process of advancing was mainly to pass the tasks in the list to the executed <code>execute func</code>. Let&#x27;s start with the execution of the timer:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4">// Timer &quot;It will be executed every internal&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tw </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">TimingWheel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">onTick</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Update the current execution tick position every time it is executed</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">tickedPos </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">tickedPos </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">%</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">numSlots</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Get the doubly linked list of stored tasks in the tick position at this time</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    l </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">slots</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">tickedPos</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">scanAndRunTasks</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Next is how to execute <code>execute</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tw </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">TimingWheel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">scanAndRunTasks</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">list</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">List</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Store the task{key, value} that needs to be executed at present [parameters required by execute, which are passed to execute in turn]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">var</span><span class="token plain"> tasks </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">timingTask</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> e </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Front</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> e </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        task </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">timingEntry</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Mark the deletion, do the real deletion in scan &quot;Delete the map data&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">removed </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            next </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Next</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Remove</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">timers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Del</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            e </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> next</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#ff79c6">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">circle </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#6272a4">// The current execution point has expired, but it is not at the first level at the same time, so now that the current level has been completed, it will drop to the next level</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#6272a4">// But did not modify pos</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">circle</span><span class="token operator" style="color:#ff79c6">--</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            e </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Next</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#ff79c6">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">diff </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token comment" style="color:#6272a4">// Because the diff has been marked before, you need to enter the queue again</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            next </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Next</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Remove</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            pos </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">tickedPos </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">diff</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">%</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">numSlots</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">slots</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">pos</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">PushBack</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">setTimerPosition</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">pos</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">diff </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            e </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> next</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#ff79c6">continue</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4">// The above cases are all cases that cannot be executed, and those that can be executed will be added to tasks</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        tasks </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">append</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tasks</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> timingTask</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">   task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            value</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        next </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Next</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Remove</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">timers</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Del</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        e </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> next</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// for range tasks, and then execute each task-&gt;execute</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">runTasks</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tasks</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The specific branching situation is explained in the comments. When you look at it, it can be combined with the previous <code>moveTask()</code>, where the <code>circle</code> drops, and the calculation of <code>diff</code> is the key to linking the two functions.</p><p>As for the calculation of <code>diff</code>, the calculation of <code>pos, circle</code> is involved:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4">// interval: 4min, d: 60min, numSlots: 16, tickedPos = 15</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// step = 15, pos = 14, circle = 0</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tw </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">TimingWheel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">getPositionAndCircle</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">d time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Duration</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">pos </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> circle </span><span class="token builtin" style="color:#bd93f9">int</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    steps </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">int</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">d </span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">interval</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    pos </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">tickedPos </span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain"> steps</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">%</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">numSlots</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    circle </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">steps </span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain"> tw</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">numSlots</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The above process can be simplified to the following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">steps </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> d </span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain"> interval</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">pos </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> step </span><span class="token operator" style="color:#ff79c6">%</span><span class="token plain"> numSlots </span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">circle </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">step </span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain"> numSlots</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>The <code>timingWheel</code> is driven by the timer. As the time advances, the tasks of the <code>list</code> &quot;doubly linked list&quot; in the <strong>current time grid</strong> will be taken out and passed to the <code>execute</code> for execution.</p><p>In terms of time separation, the time wheel has <code>circle</code> layers, so that the original <code>numSlots</code> can be reused continuously, because the timer is constantly <code>loop</code>, and execution can drop the upper layer <code>slot</code> to the lower layer. You can execute the task up to the upper level continuously in the <code>loop</code>.</p><p>There are many useful component tools in <code>go-zero</code>. Good use of tools is of great help to improve service performance and development efficiency. I hope this article can bring you some gains.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/zeromicro/portal/edit/main/docs/blog/principle/timing-wheel.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2022-05-01T07:55:16.000Z" class="lastUpdatedDate_nN9m">5/1/2022</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/blog/concurrency/sharedcalls"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« SharedCalls</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/blog/showcase/shorturl"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Rapid development of microservices »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#timingwheel-in-cache" class="table-of-contents__link">timingWheel in cache</a><ul><li><a href="#initialization" class="table-of-contents__link">Initialization</a></li><li><a href="#task-operation" class="table-of-contents__link">Task Operation</a></li><li><a href="#execute" class="table-of-contents__link">Execute</a></li></ul></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer_rm3y section_bQ6r"><div class="footer__inner_OWoZ section--inner_6-fB"><div class="footer__column_+a5z footer__column--left_4bpB"><div><img alt="go-zero logo" class="footer__logo_ayM4" height="27" src="/img/footer/go-zero.svg" title="go-zero" width="108"><img alt="stars" height="27" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="footer__logo_ayM4"><img alt="forks" height="27" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="footer__logo_ayM4"></div><p class="footer__tagline_b1u+">go-zero is a web and rpc framework that with lots of engineering practices builtin</p><a class="footer__github_okz3 button_f7Ff button--icon_q89D button--secondary_x3vq button--xsmall_fwzy" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_+a5z footer__column--right_FGdI"><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">zeromicro</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-api" rel="noopener noreferrer" target="_blank">zero-api</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-queue" rel="noopener noreferrer" target="_blank">go-queue</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/awesome-zero" rel="noopener noreferrer" target="_blank">awesome-zero</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-examples" rel="noopener noreferrer" target="_blank">zero-example</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Community</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank">GitHub</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://discord.gg/4JQvC5A4Fe" rel="noopener noreferrer" target="_blank">Discord</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Links</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://go-zero.dev/cn" rel="noopener noreferrer" target="_blank">Older Doc</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="/blog/blog">Blog</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" rel="noopener noreferrer" target="_blank">Roadmap</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://landscape.cncf.io/?selected=go-zero" rel="noopener noreferrer" target="_blank">CNCF</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Chat</li><li class="footer__item_K578"><img alt="discord" width="80" src="/img/footer/discord.png" class="footer__img_4fbU"></li></ul></div></div></div><div class="footer__bottom_rXtt"><p class="footer__copyright_9e29">Copyright © 2022 zeromicro</p><ul><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/portal/blob/main/LICENSE">License</a></li></ul><p></p></div></footer></div>
<script src="/assets/js/main.7568d8b8.js" defer="defer"></script>
</body>
</html>