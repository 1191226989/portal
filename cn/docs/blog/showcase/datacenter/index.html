<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="zeromicro">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="https://doc.go-zero.dev/favicon.png">
<link rel="icon" href="https://doc.go-zero.dev/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="https://doc.go-zero.dev/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/cn/blog/rss.xml" title="go-zero Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cn/blog/atom.xml" title="go-zero Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZD0YKV3XQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XZD0YKV3XQ",{anonymize_ip:!0})</script>
<link rel="manifest" href="//manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c"><title data-react-helmet="true">我是如何用 go-zero 实现一个中台系统 | go-zero</title><meta data-react-helmet="true" property="og:image" content><meta data-react-helmet="true" name="twitter:image" content><meta data-react-helmet="true" name="twitter:description" content="go-zero 是一个集成了各种工程实践的 web 和 rpc 框架。通过弹性设计保障了大并发服务端的稳定性，经受了充分的实战检验。"><meta data-react-helmet="true" name="twitter:title" content="Introduction | go-zero"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Introduction | go-zero&quot;"><meta data-react-helmet="true" property="og:title" content="我是如何用 go-zero 实现一个中台系统 | go-zero"><meta data-react-helmet="true" name="description" content="作者：Jack Luo"><meta data-react-helmet="true" property="og:description" content="作者：Jack Luo"><link rel="stylesheet" href="/cn/assets/css/styles.1ca73be8.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="">
<meta itemprop="description" content="go-zero 是一个集成了各种工程实践的 web 和 rpc 框架。通过弹性设计保障了大并发服务端的稳定性，经受了充分的实战检验。">
<meta itemprop="url" content="https://doc.go-zero.dev">
<meta itemprop="logo" content="https://doc.go-zero.dev/img/favicon.png">
<meta itemprop="sameAs" content="https://github.com/zeromicro">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light navbar--fixed-top"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="brand_AtiA" href="/cn/"><img alt="logo" height="30" src="/cn/img/navbar/logo.svg" class="brand_logo_MqNk"><a class="navbar__brand brand_name_O39n">go-zero</a></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">文档</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/prepare/prepare">环境准备</a></li><li><a class="dropdown__link" href="/cn/docs/quick-start/quick-start">快速开始</a></li><li><a class="dropdown__link" href="/cn/docs/advance/advance">进阶指南</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" sidebarid="goctl">Goctl</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/goctl/installation">安装</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/api">API 指令</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/zrpc">RPC 指令</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/model">Model 指令</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/completion">自动补全</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">生态</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/eco/plugins">Goctl 插件</a></li><li><a class="dropdown__link" href="/cn/docs/eco/editor">编辑器插件</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">社区</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/community/about-us">关于我们</a></li><li><a class="dropdown__link" href="/cn/docs/community/showcase">案例展示</a></li><li><a class="dropdown__link" href="/cn/docs/community/contribute">参与贡献</a></li><li><a class="dropdown__link" href="/cn/docs/community/contributor">贡献人员</a></li><li><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li><li><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord</a></li></ul></div><a class="navbar__item navbar__link" sidebarid="blog" href="/cn/docs/blog/blog">博客</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">更多</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/resource-center/learning-resource">资源中心</a></li><li><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="dropdown__link">视频教程</a></li><li><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="dropdown__link">开发路线图</a></li><li><a class="dropdown__link" href="/cn/docs/design/design">设计文档</a></li><li><a class="dropdown__link" href="/cn/docs/faq/troubleshooting">FAQ</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchWrapper_f8aU"><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文简体</span></span></a><ul class="dropdown__menu"><li><a href="/docs/blog/showcase/datacenter" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/cn/docs/blog/showcase/datacenter" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文简体</a></li></ul></div><a href="https://github.com/zeromicro/go-zero" class="navbar__items navbar__items--right"><img alt="forks" height="30" src="/cn/img/navbar/github.svg" class="star__fork_dBtt"><div class="star_fork_layout_ROo5"><img alt="stars" height="20" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="star__fork_dBtt"><img alt="forks" height="20" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="star__fork_dBtt"></div></a><div class="react-toggle themeToggleInHeading_b3Mq react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">🌙</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">☀</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/cn/">go-zero</a><div class="react-toggle themeToggleInSidebar_qGRI react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">🌙</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">☀</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/docs/blog/showcase/datacenter" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/docs/blog/showcase/datacenter" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">中文简体</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">文档</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/prepare/prepare">环境准备</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/quick-start/quick-start">快速开始</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/advance/advance">进阶指南</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist" sidebarid="goctl">Goctl</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/installation">安装</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/api">API 指令</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/zrpc">RPC 指令</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/model">Model 指令</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/completion">自动补全</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">生态</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/eco/plugins">Goctl 插件</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/eco/editor">编辑器插件</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">社区</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/about-us">关于我们</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/showcase">案例展示</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/contribute">参与贡献</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/contributor">贡献人员</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></li><li class="menu__list-item"><a class="menu__link" sidebarid="blog" href="/cn/docs/blog/blog">博客</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">更多</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/resource-center/learning-resource">资源中心</a></li><li class="menu__list-item"><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="menu__link">视频教程</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="menu__link">开发路线图</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/design/design">设计文档</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/faq/troubleshooting">FAQ</a></li></ul></li></ul></div></div></div></nav><div class="wrapper_DIJ0"><div class="doc_D+rh"><div class="doc__sidebar_gVFN" role="complementary"><div class="sidebar_LIo8"><div class="menu menu--responsive thin-scrollbar menu_oAhv"><button aria-label="打开" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_nrF-" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" href="/cn/docs/blog/blog">博客</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">服务治理</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/bloom">bloom</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/breaker-algorithms">熔断原理与实现</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/loadshedding">服务自适应降载保护设计</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/periodlimit">periodlimit</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/tokenlimit">tokenlimit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">缓存设计</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/cache">DB缓存机制</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/redis-cache">go-zero缓存设计之持久层缓存</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/business-cache">go-zero缓存设计之业务层缓存</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/collection">通过 collection.Cache 进行缓存</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">组件介绍</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/tool/executors">executors</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/tool/keywords">高效的关键词替换和敏感词过滤工具</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/tool/logx">logx</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">并发编程</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/fx">数据的流处理利器</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/mapreduce">通过MapReduce降低服务响应时间</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/stream">流数据处理利器</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/redis-lock">redis lock</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/sharedcalls">防止缓存击穿之进程内共享调用</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">原理介绍</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/principle/timing-wheel">TimingWheel</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u menu__link--sublist menu__link--active" href="#!">案例展示</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/shorturl">快速构建高并发微服务</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/zrpc">企业级RPC框架zRPC</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/mysql">mysql</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/mapping">文本序列化和反序列化</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menuLink_Zq3u menu__link--active active" tabindex="0" href="/cn/docs/blog/showcase/datacenter">我是如何用 go-zero 实现一个中台系统</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/go-queue">go-zero 分布式定时任务</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/go-zero-looklook">使用go-zero开发一个旅游系统go-zero-looklook</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/metric">基于prometheus的微服务指标监控</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">线上交流</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/share/online-exchange">10月3日线上交流问题汇总</a></li></ul></li></ul></div></div></div><main class="doc__main_VklL"><div class="padding-vert--lg container doc__item-wrapper_FIxd"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">我是如何用 go-zero 实现一个中台系统</h1></header><div class="markdown"><blockquote><p>作者：Jack Luo</p><p>原文连接：<a href="https://www.cnblogs.com/jackluo/p/14148518.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/jackluo/p/14148518.html</a></p></blockquote><p>[TOC]</p><p>最近发现golang社区里出了一个新星的微服务框架，来自好未来，光看这个名字，就很有奔头，之前，也只是玩过go-micro，其实真正的还没有在项目中运用过，只是觉得 微服务，grpc 这些很高大尚，还没有在项目中，真正的玩过，我看了一下官方提供的工具真的很好用，只需要定义好，舒适文件jia结构 都生成了，只需要关心业务，加上最近 有个投票的活动，加上最近这几年中台也比较火，所以决定玩一下，</p><blockquote><p>开源地址: <a href="https://github.com/jackluo2012/datacenter" target="_blank" rel="noopener noreferrer">https://github.com/jackluo2012/datacenter</a></p></blockquote><p>先聊聊中台架构思路吧：</p><p><img src="https://img2020.cnblogs.com/blog/203395/202012/203395-20201217094615171-335437652.jpg"></p><p>中台的概念大概就是把一个一个的app 统一起来，反正我是这样理解的。</p><p>先聊用户服务吧，现在一个公司有很多的公众号、小程序、微信的、支付宝的，还有 xxx xxx，很多的平台，每次开发的时候，我们总是需要做用户登陆的服务，不停的复制代码，然后我们就在思考能不能有一套独立的用户服务，只需要告诉我你需要传个你要登陆的平台(比如微信)，微信登陆，需要的是客户端返回给服务端一个code ，然后服务端拿着这个code去微信获取用户信息，反正大家都明白。</p><p>我们决定，将所有的信息弄到配置公共服务中去，里面再存微信、支付宝以及其它平台的appid、appkey、还有支付的appid、appkey，这样就写一套。</p><hr><p>最后说说实现吧，整个就一个repo：</p><ul><li>网关，我们用的是: go-zero的Api服务</li><li>其它它的是服务，我们就是用的go-zero的rpc服务</li></ul><p>看下目录结构</p><p><img src="https://img2020.cnblogs.com/blog/203395/202012/203395-20201209110504600-317546535.png"></p><p>整个项目完成，我一个人操刀，写了1个来星期，我就实现了上面的中台系统。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="datacenter-api服务"></a>datacenter-api服务<a class="hash-link" href="#datacenter-api服务" title="跳转到标题">#</a></h2><p>先看官方文档 <a href="https://go-zero.dev/cn/" target="_blank" rel="noopener noreferrer">https://go-zero.dev/cn/</a></p><p>我们先把网关搭建起来：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜ blogs </span><span class="token function" style="color:#8be9fd">mkdir</span><span class="token plain"> datacenter </span><span class="token operator" style="color:#ff79c6">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#bd93f9">cd</span><span class="token plain"> datacenter</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜ datacenter go mod init datacenter</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">go: creating new go.mod: module datacenter</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜ datacenter</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>查看book目录：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  datacenter tree</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── go.mod</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">0 directories, 1 file</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="创建api文件"></a>创建api文件<a class="hash-link" href="#创建api文件" title="跳转到标题">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  datacenter goctl api -o datacenter.api</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Done.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  datacenter tree</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── datacenter.api</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── user.api  #用户</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── votes.api #投票</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── search.api #搜索</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── questions.api #问答</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── go.mod</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="定义api服务"></a>定义api服务<a class="hash-link" href="#定义api服务" title="跳转到标题">#</a></h3><p>分别包含了上面的 <strong>公共服务</strong>，<strong>用户服务</strong>，<strong>投票活动服务</strong></p><p>datacenter.api的内容:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">info(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    title: &quot;中台系统&quot;// TODO: add title</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    desc: &quot;中台系统&quot;// TODO: add description</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    author: &quot;jackluo&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    email: &quot;net.webjoy@gmail.com&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import &quot;user.api&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import &quot;votes.api&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import &quot;search.api&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import &quot;questions.api&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">//获取 应用信息</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type Beid {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Beid int64 `json:&quot;beid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type Token {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Token string `json:&quot;token&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type WxTicket {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Ticket string `json:&quot;ticket&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type Application {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Sname       string `json:&quot;Sname&quot;`       //名称</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Logo        string `json:&quot;logo&quot;`        // login</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Isclose     int64  `json:&quot;isclose&quot;`     //是否关闭</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Fullwebsite string `json:&quot;fullwebsite&quot;` // 全站名称</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type SnsReq {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Beid</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Ptyid   int64  `json:&quot;ptyid&quot;`    //对应平台</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    BackUrl string `json:&quot;back_url&quot;` //登陆返回的地址</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type SnsResp {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Beid</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Ptyid    int64  `json:&quot;ptyid&quot;`     //对应平台</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Appid    string `json:&quot;appid&quot;`     //sns 平台的id</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Title    string `json:&quot;title&quot;`     //名称</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    LoginUrl string `json:&quot;login_url&quot;` //微信登陆的地址</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type WxShareResp {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Appid     string `json:&quot;appid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Timestamp int64  `json:&quot;timestamp&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Noncestr  string `json:&quot;noncestr&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Signature string `json:&quot;signature&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">@server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    group: common</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service datacenter-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;获取站点的信息&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler appInfo</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /common/appinfo (Beid) returns (Application)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;获取站点的社交属性信息&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler snsInfo</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /common/snsinfo (SnsReq) returns (SnsResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    //获取分享的</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler wxTicket</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /common/wx/ticket (SnsReq) returns (WxShareResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">//上传需要登陆</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">@server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    jwt: Auth</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    group: common</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service datacenter-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;七牛上传凭证&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler qiuniuToken</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /common/qiuniu/token (Beid) returns (Token)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>user.api内容</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">//注册请求</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type RegisterReq struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    // TODO: add members here and delete this comment</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Mobile   string `json:&quot;mobile&quot;` //基本一个手机号码就完事</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Password string `json:&quot;password&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Smscode string `json:&quot;smscode&quot;` //短信码</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">//登陆请求</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type LoginReq struct{</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Mobile   string `json:&quot;mobile&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Type int64 `json:&quot;type&quot;`    //1.密码登陆，2.短信登陆</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Password string `json:&quot;password&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">//微信登陆</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type WxLoginReq struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Code string `json:&quot;code&quot;` //微信登陆密钥</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">//返回用户信息</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type UserReply struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Auid       int64  `json:&quot;auid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Uid       int64  `json:&quot;uid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Username string `json:&quot;username&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Mobile   string `json:&quot;mobile&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Nickname string `json:&quot;nickname&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Openid string `json:&quot;openid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Avator string `json:&quot;avator&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    JwtToken</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">//返回APPUser</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type AppUser struct{</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Uid       int64  `json:&quot;uid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Auid       int64  `json:&quot;auid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Nickname string `json:&quot;nickname&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Openid string `json:&quot;openid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Avator string `json:&quot;avator&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type LoginAppUser struct{</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Uid       int64  `json:&quot;uid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Auid       int64  `json:&quot;auid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Nickname string `json:&quot;nickname&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Openid string `json:&quot;openid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Avator string `json:&quot;avator&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    JwtToken</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type JwtToken struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    AccessToken  string `json:&quot;access_token,omitempty&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    AccessExpire int64  `json:&quot;access_expire,omitempty&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    RefreshAfter int64  `json:&quot;refresh_after,omitempty&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type UserReq struct{</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Auid       int64  `json:&quot;auid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Uid       int64  `json:&quot;uid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type Request {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Name string `path:&quot;name,options=you|me&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type Response {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Message string `json:&quot;message&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">@server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    group: user</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service datacenter-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler ping</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /user/ping ()</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler register</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /user/register (RegisterReq) returns (UserReply)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler login</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /user/login (LoginReq) returns (UserReply)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler wxlogin</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /user/wx/login (WxLoginReq) returns (LoginAppUser)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler code2Session</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /user/wx/login () returns (LoginAppUser)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">@server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    jwt: Auth</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    group: user</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    middleware: Usercheck</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service datacenter-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler userInfo</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /user/dc/info (UserReq) returns (UserReply)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>votes.api 投票内容</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">// 投票活动api</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type Actid struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Actid       int64  `json:&quot;actid&quot;` //活动id</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type VoteReq struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Aeid       int64  `json:&quot;aeid&quot;` // 作品id</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Actid</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type VoteResp struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    VoteReq</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Votecount       int64  `json:&quot;votecount&quot;` //投票票数</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Viewcount       int64  `json:&quot;viewcount&quot;` //浏览数</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// 活动返回的参数</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type ActivityResp struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Actid           int64  `json:&quot;actid&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Title           string  `json:&quot;title&quot;` //活动名称</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Descr           string  `json:&quot;descr&quot;` //活动描述</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    StartDate       int64  `json:&quot;start_date&quot;` //活动时间</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    EnrollDate      int64  `json:&quot;enroll_date&quot;` //投票时间</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    EndDate         int64  `json:&quot;end_date&quot;` //活动结束时间</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Votecount       int64  `json:&quot;votecount&quot;` //当前活动的总票数</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Viewcount       int64  `json:&quot;viewcount&quot;` //当前活动的总浏览数</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Type            int64 `json:&quot;type&quot;` //投票方式</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Num             int64 `json:&quot;num&quot;` //投票几票</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">//报名</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type EnrollReq struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Actid</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Name        string  `json:&quot;name&quot;` // 名称</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Address         string  `json:&quot;address&quot;` //地址</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Images          []string  `json:&quot;images&quot;` //作品图片</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Descr           string  `json:&quot;descr&quot;` // 作品描述</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// 作品返回</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type EnrollResp struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Actid</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Aeid        int64 `json:&quot;aeid&quot;` // 作品id</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Name        string  `json:&quot;name&quot;` // 名称</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Address         string  `json:&quot;address&quot;` //地址</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Images          []string  `json:&quot;images&quot;` //作品图片</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Descr           string  `json:&quot;descr&quot;` // 作品描述</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Votecount       int64  `json:&quot;votecount&quot;` //当前活动的总票数</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Viewcount       int64  `json:&quot;viewcount&quot;` //当前活动的总浏览数</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">@server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    group: votes</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service datacenter-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;获取活动的信息&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler activityInfo</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /votes/activity/info (Actid) returns (ActivityResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;活动访问+1&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler activityIcrView</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /votes/activity/view (Actid) returns (ActivityResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;获取报名的投票作品信息&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler enrollInfo</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /votes/enroll/info (VoteReq) returns (EnrollResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;获取报名的投票作品列表&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler enrollLists</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /votes/enroll/lists (Actid) returns(EnrollResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">@server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    jwt: Auth</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    group: votes</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    middleware: Usercheck</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service datacenter-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;投票&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler vote</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /votes/vote (VoteReq) returns (VoteResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler enroll</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /votes/enroll (EnrollReq) returns (EnrollResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>questions.api 问答内容:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">// 问答 抽奖 开始</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">@server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    group: questions</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service datacenter-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;获取活动的信息&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler activitiesInfo</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /questions/activities/info (Actid) returns (ActivityResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;获取奖品信息&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler awardInfo</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /questions/award/info (Actid) returns (ActivityResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler awardList</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /questions/award/list (Actid) returns (ActivityResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type AnswerReq struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ActivityId  int64 `json:&quot;actid&quot;` </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Answers string `json:&quot;answers&quot;` </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Score   string `json:&quot;score&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type QuestionsAwardReq struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ActivityId  int64 `json:&quot;actid&quot;` </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    AnswerId    int64 `json:&quot;answerid&quot;` </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type AnswerResp struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Answers string `json:&quot;answers&quot;` </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Score   string `json:&quot;score&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type AwardConvertReq struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    UserName    string `json:&quot;username&quot;` </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Phone       string `json:&quot;phone&quot;` </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    LotteryId   int64 `json:&quot;lotteryid&quot;` </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">@server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    jwt: Auth</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    group: questions</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    middleware: Usercheck</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service datacenter-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;获取题目&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler lists</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /questions/lists (VoteReq) returns (AnswerResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;提交答案&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler change</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /questions/change (AnswerReq) returns (VoteResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;获取分数&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler grade</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /questions/grade (VoteReq) returns (VoteResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;开始转盘&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler turntable</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /questions/lottery/turntable (EnrollReq) returns (EnrollResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;填写中奖信息人&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler lottery</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /questions/lottery/convert (AwardConvertReq) returns (EnrollResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// 问答 抽奖 结束</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>search.api 搜索</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type SearchReq struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Keyword string `json:&quot;keyword&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Page string `json:&quot;page&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Size string `json:&quot;size&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type SearchResp struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Data []ArticleReq `json:&quot;data&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type ArticleReq struct{</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    NewsId string `json:&quot;NewsId&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    NewsTitle string `json:&quot;NewsTitle&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ImageUrl string `json:&quot;ImageUrl&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">@server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    group: search</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    middleware: Admincheck</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service datacenter-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @doc(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        summary: &quot;搜索&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler article</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /search/article (SearchReq) returns (SearchResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler articleInit</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    get /search/articel/init (SearchReq) returns (SearchResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    @handler articleStore</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    post /search/articel/store (ArticleReq) returns (ArticleReq)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>上面基本上写就写的API及文档的思路</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="生成datacenter-api服务"></a>生成datacenter api服务<a class="hash-link" href="#生成datacenter-api服务" title="跳转到标题">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  datacenter goctl api go -api datacenter.api -dir .</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Done.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  datacenter treer</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── datacenter.api</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── etc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   └── datacenter-api.yaml</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── go.mod</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── internal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   ├── config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   └── config.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   ├── handler</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   ├── common</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── appinfohandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── qiuniutokenhandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── snsinfohandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── votesverificationhandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   └── wxtickethandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   ├── routes.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   ├── user</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── code2sessionhandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── loginhandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── pinghandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── registerhandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── userinfohandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   └── wxloginhandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   └── votes</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── activityicrviewhandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── activityinfohandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── enrollhandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── enrollinfohandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── enrolllistshandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       └── votehandler.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   ├── logic</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   ├── common</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── appinfologic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── qiuniutokenlogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── snsinfologic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── votesverificationlogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   └── wxticketlogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   ├── user</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── code2sessionlogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── loginlogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── pinglogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── registerlogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   ├── userinfologic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   │   └── wxloginlogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   └── votes</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── activityicrviewlogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── activityinfologic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── enrollinfologic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── enrolllistslogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       ├── enrolllogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │       └── votelogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   ├── middleware</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   └── usercheckmiddleware.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   ├── svc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   └── servicecontext.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   └── types</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│       └── types.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── datacenter.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">14 directories, 43 files</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>我们打开 <code>etc/datacenter-api.yaml</code> 把必要的配置信息加上</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token key atrule">Name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> datacenter</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">api</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">Log</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Mode</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> console</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">Host</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 0.0.0.0</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">Port</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">8857</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">Auth</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">AccessSecret</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 你的jwtwon Secret</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">AccessExpire</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">86400</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">CacheRedis</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">Host</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">6379</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Pass</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 密码</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Type</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> node                     </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">UserRpc</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Etcd</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">Hosts</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">2379</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">Key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> user.rpc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">CommonRpc</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Etcd</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">Hosts</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">2379</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">Key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> common.rpc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">VotesRpc</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Etcd</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">Hosts</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">2379</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">Key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> votes.rpc</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>上面的 <code>UserRpc</code>， <code>CommonRpc</code> ,还有 <code>VotesRpc</code> 这些我先写上，后面再来慢慢加。</p><p>我们先来写 <code>CommonRpc</code> 服务。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="commonrpc服务"></a>CommonRpc服务<a class="hash-link" href="#commonrpc服务" title="跳转到标题">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="新建项目目录"></a>新建项目目录<a class="hash-link" href="#新建项目目录" title="跳转到标题">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  datacenter mkdir -p common/rpc &amp;&amp; cd common/rpc</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>直接就新建在了，datacenter目录中，因为common 里面，可能以后会不只会提供rpc服务，可能还有api的服务,所以又加了rpc目录</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="goctl创建模板"></a>goctl创建模板<a class="hash-link" href="#goctl创建模板" title="跳转到标题">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  rpc goctl rpc template -o=common.proto</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  rpc ls</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">common.proto</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>往里面填入内容：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI protobufbuf"><div tabindex="0" class="prism-code language-protobufbuf codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  rpc cat common.proto</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">syntax = &quot;proto3&quot;;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">option go_package = &quot;common&quot;;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">package common;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">message BaseAppReq{</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  int64 beid=1;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">message BaseAppResp{</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  int64 beid=1;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  string logo=2;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  string sname=3;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  int64 isclose=4;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  string fullwebsite=5;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// 请求的api</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">message AppConfigReq {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  int64 beid=1;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  int64 ptyid=2;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">// 返回的值</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">message AppConfigResp {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  int64 id=1;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  int64 beid=2;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  int64 ptyid=3;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  string appid=4;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  string appsecret=5;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  string title=6;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service Common {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  rpc GetAppConfig(AppConfigReq) returns(AppConfigResp);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  rpc GetBaseApp(BaseAppReq) returns(BaseAppResp);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="gotcl生成rpc服务"></a>gotcl生成rpc服务<a class="hash-link" href="#gotcl生成rpc服务" title="跳转到标题">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  rpc goctl rpc proto -src common.proto -dir </span><span class="token builtin class-name" style="color:#bd93f9">.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">protoc  -I</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">/Users/jackluo/works/blogs/datacenter/common/rpc common.proto --go_out</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">plugins</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">grpc:/Users/jackluo/works/blogs/datacenter/common/rpc/common</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Done.</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜ rpc tree</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── common</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│  └── common.pb.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── common.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── common.proto</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── commonclient</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│  └── common.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── etc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│  └── common.yaml</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── internal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│  └── config.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── logic</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│  ├── getappconfiglogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│  └── getbaseapplogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── server</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│  └── commonserver.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── svc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── servicecontext.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">8 directories, 10 files</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>基本上，就把所有的目录规范和结构的东西都生成了，就不用纠结项目目录了，怎么放了，怎么组织了。</p><p>看一下，配置信息，里面可以写入mysql和其它redis的信息：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token key atrule">Name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> common.rpc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">ListenOn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">8081</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">Mysql</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">DataSource</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> root</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">admin@tcp(127.0.0.1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">3306)/datacenter</span><span class="token punctuation" style="color:#f8f8f2">?</span><span class="token plain">charset=utf8</span><span class="token important">&amp;parseTime=true&amp;loc=Asia%2FShanghai</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">CacheRedis</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">Host</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">6379</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Pass</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Type</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> node  </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">Etcd</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Hosts</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">2379</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> common.rpc</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>我们再来加上数据库服务：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  rpc cd ..</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  common ls</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">rpc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  common pwd</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">/Users/jackluo/works/blogs/datacenter/common</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  common goctl model mysql datasource -url=&quot;root:admin@tcp(127.0.0.1:3306)/datacenter&quot; -table=&quot;base_app&quot; -dir ./model -c</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Done.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  common tree</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── model</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   ├── baseappmodel.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   └── vars.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── rpc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ├── common</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    │   └── common.pb.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ├── common.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ├── common.proto</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ├── commonclient</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    │   └── common.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ├── etc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    │   └── common.yaml</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    └── internal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        ├── config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        │   └── config.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        ├── logic</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        │   ├── getappconfiglogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        │   └── getbaseapplogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        ├── server</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        │   └── commonserver.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        └── svc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            └── servicecontext.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">10 directories, 12 files</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>这样基本的一个 <code>rpc</code> 就写完了，然后我们将rpc 和model 还有api串连起来，这个官方的文档已经很详细了，这里就只是贴一下代码：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  common cat rpc</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">internal</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">config</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">package</span><span class="token plain"> config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">type</span><span class="token plain"> Config </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RpcServerConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Mysql </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        DataSource </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    CacheRedis cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ClusterConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>再在svc中修改：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  common cat rpc</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">internal</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">svc</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">servicecontext</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">package</span><span class="token plain"> svc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/common/model&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/common/rpc/internal/config&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/core/stores/sqlx&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">type</span><span class="token plain"> ServiceContext </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    c              config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    AppConfigModel model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">AppConfigModel</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    BaseAppModel   model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">BaseAppModel</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">NewServiceContext</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">ServiceContext </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    conn </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> sqlx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewMysql</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Mysql</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">DataSource</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    apm </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewAppConfigModel</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    bam </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewBaseAppModel</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">              c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        AppConfigModel</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> apm</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        BaseAppModel</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">   bam</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>上面的代码已经将 <code>rpc</code> 和 <code>model</code> 数据库关联起来了，我们现在再将 <code>rpc</code> 和 <code>api</code> 关联起来：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  datacenter cat internal</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">config</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">package</span><span class="token plain"> config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/rest&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">type</span><span class="token plain"> Config </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    rest</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RestConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Auth </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        AccessSecret </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        AccessExpire </span><span class="token builtin" style="color:#bd93f9">int64</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    UserRpc   zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RpcClientConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    CommonRpc zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RpcClientConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    VotesRpc  zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RpcClientConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    CacheRedis cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ClusterConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>加入 <code>svc</code> 服务中：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">➜  datacenter cat internal</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">svc</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">servicecontext</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">package</span><span class="token plain"> svc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;context&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/common/rpc/commonclient&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/internal/config&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/internal/middleware&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/shared&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/user/rpc/userclient&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/votes/rpc/votesclient&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;fmt&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;net/http&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;time&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/core/logx&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/core/stores/redis&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/core/syncx&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/rest&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;google.golang.org/grpc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">type</span><span class="token plain"> ServiceContext </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Config           config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    GreetMiddleware1 rest</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Middleware</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    GreetMiddleware2 rest</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Middleware</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Usercheck        rest</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Middleware</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    UserRpc          userclient</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">User </span><span class="token comment" style="color:#6272a4">//用户</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    CommonRpc        commonclient</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Common</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    VotesRpc         votesclient</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Votes</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Cache            cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Cache</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    RedisConn        </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">redis</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Redis</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">timeInterceptor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> method </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> reply </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> cc </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">grpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ClientConn</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> invoker grpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">UnaryInvoker</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> opts </span><span class="token operator" style="color:#ff79c6">...</span><span class="token plain">grpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CallOption</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    stime </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Now</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">invoker</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> reply</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> cc</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> opts</span><span class="token operator" style="color:#ff79c6">...</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Printf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;调用 %s 方法 耗时: %v\n&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Now</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Sub</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stime</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">NewServiceContext</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">ServiceContext </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ur </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> userclient</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewUser</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">MustNewClient</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">UserRpc</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">WithUnaryClientInterceptor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">timeInterceptor</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    cr </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> commonclient</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewCommon</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">MustNewClient</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CommonRpc</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">WithUnaryClientInterceptor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">timeInterceptor</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    vr </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> votesclient</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewVotes</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">MustNewClient</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">VotesRpc</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">WithUnaryClientInterceptor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">timeInterceptor</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">//缓存</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ca </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewCache</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> syncx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewSharedCalls</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewCacheStat</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;dc&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ErrNotFound</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    rcon </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewRedis</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Host</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Type</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Pass</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        Config</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">           c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        GreetMiddleware1</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> greetMiddleware1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        GreetMiddleware2</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> greetMiddleware2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        Usercheck</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">        middleware</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewUserCheckMiddleware</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Handle</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        UserRpc</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">          ur</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        CommonRpc</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">        cr</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        VotesRpc</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">         vr</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        Cache</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">            ca</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        RedisConn</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">        rcon</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>这样基本上，我们就可以在 <code>logic</code> 的文件目录中调用了：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">cat internal</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">logic</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">common</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">appinfologic</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">package</span><span class="token plain"> logic</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;context&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/internal/svc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/internal/types&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/shared&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/common/model&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;datacenter/common/rpc/common&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#f1fa8c">&quot;github.com/zeromicro/go-zero/core/logx&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">type</span><span class="token plain"> AppInfoLogic </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    logx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Logger</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    ctx    context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    svcCtx </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">svc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ServiceContext</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">NewAppInfoLogic</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> svcCtx </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">svc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> AppInfoLogic </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> AppInfoLogic</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        Logger</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> logx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">WithContext</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        ctx</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">    ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        svcCtx</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> svcCtx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">AppInfoLogic</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">AppInfo</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">req types</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Beid</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">appconfig </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">common</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">BaseAppResp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">//检查 缓存中是否有值</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">GetCache</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">GetcacheBaseAppIdPrefix</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Beid</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> appconfig</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;&amp;</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">==</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ErrNotFound </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        appconfig</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CommonRpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">GetBaseApp</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">common</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">BaseAppReq</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            Beid</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> req</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Beid</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        err </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">SetCache</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">GetcacheBaseAppIdPrefix</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Beid</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> appconfig</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>这样，基本就连接起来了，其它基本上就不用改了，<code>UserRPC</code>， <code>VotesRPC</code> 类似，这里就不在写了。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="使用心得"></a>使用心得<a class="hash-link" href="#使用心得" title="跳转到标题">#</a></h2><p><code>go-zero</code> 的确香，因为它有一个 <code>goctl</code> 的工具，他可以自动的把代码结构全部的生成好，我们就不再去纠结，目录结构 ，怎么组织，没有个好几年的架构能力是不好实现的，有什么规范那些，并发，熔断，完全不用，考虑其它的，专心的实现业务就好，像微服务，还要有服务发现，一系列的东西，都不用关心，因为 <code>go-zero</code> 内部已经实现了。</p><p>我写代码也写了有10多年了，之前一直用的 php，比较出名的就 laravel，thinkphp，基本上就是模块化的，像微服务那些实现真的有成本，但是你用上go-zero，你就像调api接口一样简单的开发，其它什么服务发现，那些根本就不用关注了，只需要关注业务。</p><p>一个好的语言，框架，他们的底层思维，永远都是效率高，不加班的思想，我相信go-zero会提高你和你团队或是公司的效率。go-zero的作者说，他们有个团队专门整理go-zero框架，目的也应该很明显，那就是提高，他们自己的开发效率，流程化，标准化，是提高工作效率的准则，像我们平时遇到了问题，或是遇到了bug，我第一个想到的不是怎么去解决我的bug，而是在想我的流程是不是有问题，我的哪个流程会导致bug，最后我相信 <code>go-zero</code> 能成为 <strong>微服务开发</strong> 的首选框架。</p><p>最后说说遇到的坑吧：</p><ul><li><code>grpc</code></li></ul><p><code>grpc</code> 本人第一次用，然后就遇到了，有些字符为空时，字段值不显示的问题：</p><p>通过 <code>grpc</code> 官方库中的 <code>jsonpb</code> 来实现，官方在它的设定中有一个结构体用来实现 <code>protoc buffer</code> 转换为JSON结构，并可以根据字段来配置转换的要求。</p><ul><li>跨域问题</li></ul><p><code>go-zero</code> 中设置了，感觉没有效果，大佬说通过nginx 设置，后面发现还是不行，最近强行弄到了一个域名下，后面有时间再解决。</p><ul><li><code>sqlx</code></li></ul><p><code>go-zero</code> 的 <code>sqlx</code> 问题，这个真的费了很长的时间：</p><blockquote><p><code>time.Time</code> 这个数据结构，数据库中用的是 timestamp 这个 比如我的字段 是delete_at 默认数库设置的是null ，结果插入的时候，就报了 <code>Incorrect datetime value: &#x27;0000-00-00&#x27; for column &#x27;deleted_at&#x27; at row 1&quot;}</code> 这个错，查询的时候报 <code>deleted_at\&quot;: unsupported Scan, storing driver.Value type \u003cnil\u003e into type *time.Time&quot;</code>
后面果断去掉了这个字段，字段上面加上 <code>.omitempty</code> 这个标签，好像也有用，<code>db:&quot;.omitempty&quot;</code></p></blockquote><p>其次就是这个 <code>Conversion from collation utf8_general_ci into utf8mb4_unicode_ci</code>，这个导致的大概原因是，现在都喜欢用emj表情了，mysql数据识别不了。</p><ul><li>数据连接</li></ul><p><code>mysql</code> 这边照样按照原始的方式,将配置文件修改编码格式，重新创建数据库，并且设置数据库编码为utf8mb4，排序规则为 <code>utf8mb4_unicode_ci</code>。</p><p><strong>这样的话,所有的表还有string字段都是这个编码格式,如果不想所有的都是,可以单独设置,这个不是重点.因为在navicat上都好设置,手动点一下就行了</strong>。</p><p>重点来了：golang中使用的是 <code>github.com/go-sql-driver/mysql</code> 驱动，将连接 <code>mysql</code>的 <code>dsn</code>（因为我这使用的是gorm，所以dsn可能跟原生的格式不太一样，不过没关系， 只需要关注 <code>charset</code> 和 <code>collation</code> 就行了）
<code>root:password@/name?parseTime=True&amp;loc=Local&amp;charset=utf8</code> 修改为：
<code>root:password@/name?parseTime=True&amp;loc=Local&amp;charset=utf8mb4&amp;collation=utf8mb4_unicode_ci</code></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/zeromicro/portal/edit/main/i18n/cn/docusaurus-plugin-content-docs/current/blog/showcase/datacenter.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col text--right"><em><small>最后更新 日期： <time datetime="2022-04-30T13:19:43.000Z" class="lastUpdatedDate_nN9m">4/30/2022</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="文档页面导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cn/docs/blog/showcase/mapping"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">« 文本序列化和反序列化</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cn/docs/blog/showcase/go-queue"><div class="pagination-nav__sublabel">下一篇</div><div class="pagination-nav__label">go-zero 分布式定时任务 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#datacenter-api服务" class="table-of-contents__link">datacenter-api服务</a><ul><li><a href="#创建api文件" class="table-of-contents__link">创建api文件</a></li><li><a href="#定义api服务" class="table-of-contents__link">定义api服务</a></li><li><a href="#生成datacenter-api服务" class="table-of-contents__link">生成datacenter api服务</a></li></ul></li><li><a href="#commonrpc服务" class="table-of-contents__link">CommonRpc服务</a><ul><li><a href="#新建项目目录" class="table-of-contents__link">新建项目目录</a></li><li><a href="#goctl创建模板" class="table-of-contents__link">goctl创建模板</a></li><li><a href="#gotcl生成rpc服务" class="table-of-contents__link">gotcl生成rpc服务</a></li></ul></li><li><a href="#使用心得" class="table-of-contents__link">使用心得</a></li></ul></div></div></div></div></main></div></div><footer class="footer_rm3y section_bQ6r"><div class="footer__inner_OWoZ section--inner_6-fB"><div class="footer__column_+a5z footer__column--left_4bpB"><div><img alt="go-zero logo" class="footer__logo_ayM4" height="27" src="/cn/img/footer/go-zero.svg" title="go-zero" width="108"><img alt="stars" height="27" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="footer__logo_ayM4"><img alt="forks" height="27" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="footer__logo_ayM4"></div><p class="footer__tagline_b1u+">go-zero 是一个集成了各种工程实践的 web 和 rpc 框架</p><a class="footer__github_okz3 button_f7Ff button--icon_q89D button--secondary_x3vq button--xsmall_fwzy" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/cn/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_+a5z footer__column--right_FGdI"><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">zeromicro</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-api" rel="noopener noreferrer" target="_blank">zero-api</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-queue" rel="noopener noreferrer" target="_blank">go-queue</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/awesome-zero" rel="noopener noreferrer" target="_blank">awesome-zero</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-examples" rel="noopener noreferrer" target="_blank">zero-example</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">社区</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank">GitHub</a></li><li class="footer__item_K578"><span></span></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">友情链接</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://go-zero.dev/cn" rel="noopener noreferrer" target="_blank">旧文档</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="/cn/blog/blog">博客</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" rel="noopener noreferrer" target="_blank">开发路线图</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://landscape.cncf.io/?selected=go-zero" rel="noopener noreferrer" target="_blank">CNCF</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">微信二维码</li><li class="footer__item_K578"><img alt="微信群" width="80" src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/wechat.jpg" class="footer__img_4fbU"></li></ul></div></div></div><div class="footer__bottom_rXtt"><p class="footer__copyright_9e29">Copyright © 2022 zeromicro</p><ul><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero/blob/master/LICENSE">License</a></li></ul><p></p></div></footer></div>
<script src="/cn/assets/js/main.1342b969.js" defer="defer"></script>
</body>
</html>